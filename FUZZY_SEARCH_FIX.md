# FUZZY SEARCH PERFORMANCE FIX

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fuzzy –ø–æ–∏—Å–∫–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ "–∫–∞–∫–∏–µ —Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–¥–æ–π–¥—É—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–Ω–∞–ª–æ–º –∑–∞—â–∏—Ç—ã –º–∞–≥–∏—Å—Ç—Ä–∞ "–ú–µ–∫—Ç–∞–±—É"":
- –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–∞–ª–∞ –Ω–∞ 5+ –º–∏–Ω—É—Ç
- CPU –Ω–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ 100%
- GPU –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–ª (0% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- –ù–∏–∫–∞–∫–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

## –ü—Ä–∏—á–∏–Ω–∞

–°—Ç–∞—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–≤–∞–ª–∞ fuzzy regex –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è **–í–°–ï–ì–û –∑–∞–ø—Ä–æ—Å–∞** (–≤–∫–ª—é—á–∞—è –ø—Ä–æ–±–µ–ª—ã):

```python
# –ü–õ–û–•–û - —Å—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥
chars = list(query.lower())  # –í—Å–µ —Å–∏–º–≤–æ–ª—ã –∑–∞–ø—Ä–æ—Å–∞
fuzzy_pattern = '.*'.join([re.escape(c) + r'[\s\-]*' for c in chars[:-1]]) + re.escape(chars[-1])
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª–∏–Ω–æ–π 200+ —Å–∏–º–≤–æ–ª–æ–≤ —Å `.*` –º–µ–∂–¥—É –∫–∞–∂–¥–æ–π –±—É–∫–≤–æ–π.

### –ü—Ä–∏–º–µ—Ä –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞:

```regex
–∫[\s-]*.*–∞[\s-]*.*–∫[\s-]*.*–∏[\s-]*.*–µ[\s-]*.*\ [\s-]*.*—Ä[\s-]*.*–∞[\s-]*.*—Å[\s-]*.*—à[\s-]*.*–∏[\s-]*.*—Ä[\s-]*.*—è[\s-]*.*—é[\s-]*.*—â[\s-]*.*–∏[\s-]*.*–µ[\s-]*.*\ [\s-]*.*–≤[\s-]*.*–æ[\s-]*.*–ø[\s-]*.*—Ä[\s-]*.*–æ[\s-]*.*—Å[\s-]*.*—ã[\s-]*.*...
```

–ù–∞ —Ñ–∞–π–ª–µ –≤ 550,000 —Å—Ç—Ä–æ–∫ —ç—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç **catastrophic backtracking** - regex –¥–≤–∏–∂–æ–∫ –ø—Ä–æ–±—É–µ—Ç –º–∏–ª–ª–∏–∞—Ä–¥—ã –∫–æ–º–±–∏–Ω–∞—Ü–∏–π.

## –†–µ—à–µ–Ω–∏–µ

–ü—Ä–∏–º–µ–Ω—è—Ç—å fuzzy –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –∫ **–æ—Ç–¥–µ–ª—å–Ω—ã–º –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º**, –∞ –Ω–µ –∫–æ –≤—Å–µ–º—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é:

1. **–ò–∑–≤–ª–µ—á—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞** (3+ —Å–∏–º–≤–æ–ª–∞, –º–∏–Ω—É—Å stopwords)
2. **–°–æ–∑–¥–∞—Ç—å fuzzy –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –æ—Ç–¥–µ–ª—å–Ω–æ**
3. **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å —á–µ—Ä–µ–∑ OR** –≤–º–µ—Å—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
4. **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ 3 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –º–∞–∫—Å–∏–º—É–º**

### –ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```python
# –•–û–†–û–®–û - –Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥
# 1. –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
stopwords = {'—á—Ç–æ', '–∫–∞–∫', '–≥–¥–µ', '–∫–æ–≥–¥–∞', '–¥–ª—è', '—Ä–∞–±–æ—Ç—ã', '–∫–∞–Ω–∞–ª'}
words = re.findall(r'\b[–∞-—è—ë–ê-–Ø–Å]{3,}\b', query.lower())
keywords = [w for w in words if w not in stopwords]

# 2. Fuzzy –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ö–ê–ñ–î–û–ì–û —Å–ª–æ–≤–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
fuzzy_words = []
for keyword in keywords[:3]:  # –ú–∞–∫—Å–∏–º—É–º 3 —Å–ª–æ–≤–∞
    chars = list(keyword)
    fuzzy_word = ''.join([re.escape(c) + r'[\s\-]*' for c in chars[:-1]]) + re.escape(chars[-1])
    fuzzy_words.append(fuzzy_word)

# 3. –û–±—ä–µ–¥–∏–Ω—è–µ–º —á–µ—Ä–µ–∑ OR —Å word boundaries
fuzzy_pattern = '|'.join([f'\\b{fw}\\b' for fw in fuzzy_words])
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ (—Å—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥):

- **Query:** "–∫–∞–∫–∏–µ —Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–¥–æ–π–¥—É—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–Ω–∞–ª–æ–º –∑–∞—â–∏—Ç—ã –º–∞–≥–∏—Å—Ç—Ä–∞ "–ú–µ–∫—Ç–∞–±—É""
- **Pattern length:** 200+ —Å–∏–º–≤–æ–ª–æ–≤
- **Time:** 5+ –º–∏–Ω—É—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è
- **CPU:** 100%
- **GPU:** 0%
- **Result:** –ù–∏–∫–∞–∫–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –ü–æ—Å–ª–µ (–Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥):

- **Query:** "–∫–∞–∫–∏–µ —Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–¥–æ–π–¥—É—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–Ω–∞–ª–æ–º –∑–∞—â–∏—Ç—ã –º–∞–≥–∏—Å—Ç—Ä–∞ "–ú–µ–∫—Ç–∞–±—É""
- **Keywords extracted:** ["—Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ", "–≤–æ–ø—Ä–æ—Å—ã", "–ø–æ–¥–æ–π–¥—É—Ç", "–º–µ–∫—Ç–∞–±—É", "–∑–∞—â–∏—Ç—ã", "–º–∞–≥–∏—Å—Ç—Ä–∞"]
- **Keywords used (first 3):** ["—Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ", "–≤–æ–ø—Ä–æ—Å—ã", "–ø–æ–¥–æ–π–¥—É—Ç"]
- **Pattern length:** ~120 —Å–∏–º–≤–æ–ª–æ–≤ (3 fuzzy —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ OR)
- **Time:** < 1 —Å–µ–∫—É–Ω–¥–∞
- **Result:** –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫** - –º–µ–Ω–µ–µ 1 —Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ 5+ –º–∏–Ω—É—Ç
‚úÖ **–ù–∞—Ö–æ–¥–∏—Ç —Å–ª–æ–≤–∞ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏** - "–ú–µ–∫—Ç–∞–±—É" –Ω–∞–π–¥–µ—Ç "–ú–µ–∫—Ç –∞–±—É"
‚úÖ **–ù–∞—Ö–æ–¥–∏—Ç —Å–ª–æ–≤–∞ —Å –¥–µ—Ñ–∏—Å–∞–º–∏** - "–∫–æ—Å–º–æ—ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞" –Ω–∞–π–¥–µ—Ç "–∫–æ—Å–º–æ-—ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞"
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ñ–∞–π–ª–∞—Ö –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
‚úÖ **CPU —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ** - –Ω–µ—Ç catastrophic backtracking
‚úÖ **–£–º–Ω—ã–π fallback** - –µ—Å–ª–∏ –Ω–µ—Ç keywords, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: `python rag_web_modern.py`
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º "‚ö° HYBRID" –∏–ª–∏ "üîç GREP"
4. –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
5. Fuzzy –ø–æ–∏—Å–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

## –ü—Ä–∏–º–µ—Ä—ã –ø–æ–∏—Å–∫–∞

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–∏—Å–∫ "–ú–µ–∫—Ç–∞–±—É"
```
Query: –ú–µ–∫—Ç–∞–±—É
Keywords: ["–º–µ–∫—Ç–∞–±—É"]
Fuzzy pattern: \b–º[\s-]*–µ[\s-]*–∫[\s-]*—Ç[\s-]*–∞[\s-]*–±[\s-]*—É\b
–ù–∞–π–¥–µ—Ç: "–ú–µ–∫—Ç–∞–±—É", "–ú–µ–∫—Ç –∞–±—É", "–ú–µ–∫—Ç–∞–±–∞"
```

### –ü—Ä–∏–º–µ—Ä 2: –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```
Query: –∫–∞–∫–∏–µ —Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–¥–æ–π–¥—É—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ú–µ–∫—Ç–∞–±—É
Keywords: ["—Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ", "–≤–æ–ø—Ä–æ—Å—ã", "–ø–æ–¥–æ–π–¥—É—Ç", "–º–µ–∫—Ç–∞–±—É"]
Used (first 3): ["—Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ", "–≤–æ–ø—Ä–æ—Å—ã", "–ø–æ–¥–æ–π–¥—É—Ç"]
Fuzzy pattern: \b—Ä[\s-]*–∞[\s-]*—Å[\s-]*—à[\s-]*–∏[\s-]*—Ä[\s-]*—è[\s-]*—é[\s-]*—â[\s-]*–∏[\s-]*–µ\b|\b–≤[\s-]*–æ[\s-]*–ø[\s-]*—Ä[\s-]*–æ[\s-]*—Å[\s-]*—ã\b|\b–ø[\s-]*–æ[\s-]*–¥[\s-]*–æ[\s-]*–π[\s-]*–¥[\s-]*—É[\s-]*—Ç\b
```

### –ü—Ä–∏–º–µ—Ä 3: –ö–æ—Ä–æ—Ç–∫–∏–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ keywords
```
Query: 123
Keywords: [] (–Ω–µ—Ç —Å–ª–æ–≤ >=3 —Å–∏–º–≤–æ–ª–æ–≤)
Fallback: —Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ "123"
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Stopwords —Ñ–∏–ª—å—Ç—Ä
–£–¥–∞–ª—è–µ–º —á–∞—Å—Ç—ã–µ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞, —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ fuzzy –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
```python
stopwords = {'—á—Ç–æ', '–∫–∞–∫', '–≥–¥–µ', '–∫–æ–≥–¥–∞', '–∑–∞—á–µ–º', '–ø–æ—á–µ–º—É', '–∫–∞–∫–æ–π', '–∫–∞–∫–∞—è', '–∫–∞–∫–∏–µ', '–¥–ª—è', '—Ä–∞–±–æ—Ç—ã', '–∫–∞–Ω–∞–ª', '—á–∞—Å—Ç–æ—Ç–∞'}
```

### Word boundaries
–ò—Å–ø–æ–ª—å–∑—É–µ–º `\b...\b` —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ª–æ–∂–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π:
```
\b–º–µ–∫—Ç–∞–±—É\b  - –Ω–∞–π–¥–µ—Ç "–ú–µ–∫—Ç–∞–±—É" –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ
–±–µ–∑ \b      - –Ω–∞–π–¥–µ—Ç "–ú–µ–∫—Ç–∞–±—É–ù–µ—á—Ç–æ" (–ª–æ–∂–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ 3 keywords
–ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø–æ–ª–Ω–æ—Ç–æ–π –ø–æ–∏—Å–∫–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é:
- 1-3 keyword: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
- 5+ keywords: –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –∏–∑-–∑–∞ –¥–ª–∏–Ω–Ω–æ–≥–æ OR –ø–∞—Ç—Ç–µ—Ä–Ω–∞

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

Fuzzy –ø–æ–∏—Å–∫ —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ keywords:

```
INFO - GREP –∏—â–µ—Ç –≤ —Ñ–∞–π–ª–µ: cosmic_texts.txt (fuzzy=True)
INFO - Fuzzy keywords: ['—Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ', '–≤–æ–ø—Ä–æ—Å—ã', '–ø–æ–¥–æ–π–¥—É—Ç'] ‚Üí pattern length: 120 chars
```

## –ö–æ–º–º–∏—Ç

Commit: cd3cf47
Message: "Fix catastrophic backtracking in fuzzy GREP: keyword-based fuzzy search"

ü§ñ Generated with Claude Code
Co-Authored-By: Claude <noreply@anthropic.com>
